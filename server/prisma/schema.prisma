generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// user role
enum Role {
  ADMIN
  MODERATOR
}

// gray model 
model Gray {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  address      String
  phone        String
  products     Product[]
  chalans      GrayChalan[]
  grayPayments GrayPayment[]
  createAt     DateTime      @default(now())
  updateAt     DateTime      @updatedAt
}

// gray chalan model
model GrayChalan {
  id         Int           @id @default(autoincrement())
  products   Product[]
  grayId     Int
  gray       Gray          @relation(fields: [grayId], references: [id])
  payments   GrayPayment[]
  date       String
  markedPaid Boolean       @default(false)
  discount   Float?
  createAt   DateTime      @default(now())
  updateAt   DateTime      @updatedAt
}

// gray payment model
model GrayPayment {
  id       Int         @id @default(autoincrement())
  date     String
  amount   Float
  gray     Gray        @relation(fields: [grayId], references: [id])
  grayId   Int
  Chalan   GrayChalan? @relation(fields: [chalanId], references: [id])
  chalanId Int?
  createAt DateTime    @default(now())
  updateAt DateTime    @updatedAt
}

// controller user model 
model User {
  id       Int      @id @default(autoincrement())
  email    String   @unique
  name     String?
  password String
  gender   String?
  phone    String?
  role     Role     @default(MODERATOR)
  createAt DateTime @default(now())
  updateAt DateTime @updatedAt
}

// delivery status enum
enum DELIVERY_STATUS {
  IN_MILL
  IN_HOUSE
  RUNNING
}

// dyeing model
model Dyeing {
  id             Int             @id @default(autoincrement())
  name           String          @unique
  address        String
  phone          String
  products       Product[]
  dyeingPayments DyeingPayment[]
  chalans        DyeingChalan[]
  createAt       DateTime        @default(now())
  updateAt       DateTime        @updatedAt
}

// chalan model
model DyeingChalan {
  id       Int             @id @default(autoincrement())
  products Product[]
  dyeingId Int
  dyeing   Dyeing          @relation(fields: [dyeingId], references: [id])
  payments DyeingPayment[]
  date     String
  createAt DateTime        @default(now())
  updateAt DateTime        @updatedAt
}

// dyeing payment model
model DyeingPayment {
  id       Int           @id @default(autoincrement())
  date     String
  amount   Float
  dyeing   Dyeing        @relation(fields: [dyeingId], references: [id])
  dyeingId Int
  chalan   DyeingChalan? @relation(fields: [chalanId], references: [id])
  chalanId Int?
  createAt DateTime      @default(now())
  updateAt DateTime      @updatedAt
}

// product model
model Product {
  id                Int               @id @default(autoincrement())
  name              String
  //  gray details
  gray              Gray              @relation(fields: [grayId], references: [id])
  grayId            Int
  gray_amount       Float
  gray_rate         Float
  gray_date         String?
  // dyeing details
  dyeing            Dyeing?           @relation(fields: [dyeingId], references: [id])
  dyeingId          Int?
  dyeing_date       String?
  dyeing_rate       Float?
  dyeing_amount     Float?
  //finished product
  finished_products FinishedProduct[]
  // dellvery status
  delivery_status   DELIVERY_STATUS?
  // customers
  customers         CustomerProduct[]
  // chalan details
  dyeingChalan      DyeingChalan?     @relation(fields: [dyeingChalanId], references: [id])
  dyeingChalanId    Int?
  grayChalan        GrayChalan?       @relation(fields: [grayChalanId], references: [id])
  grayChalanId      Int?
  total_defected    Float?
  CustomerChalan    CustomerChalan?   @relation(fields: [customerChalanId], references: [id])
  customerChalanId  Int?
  createAt          DateTime          @default(now())
  updateAt          DateTime          @updatedAt
}

// model finished product
model FinishedProduct {
  id                Int              @id @default(autoincrement())
  amount            Float
  product           Product          @relation(fields: [productId], references: [id])
  productId         Int
  is_sold           Boolean          @default(false)
  customerProduct   CustomerProduct? @relation(fields: [customerProductId], references: [id])
  customerProductId Int?
  createAt          DateTime         @default(now())
  updateAt          DateTime         @updatedAt
}

// customer model
model Customer {
  id               Int               @id @default(autoincrement())
  name             String
  address          String
  phone            String
  products         CustomerProduct[]
  chalans          CustomerChalan[]
  customerPayments CustomerPayment[]
  createAt         DateTime          @default(now())
  updateAt         DateTime          @updatedAt
}

// customer chalan

model CustomerChalan {
  id               Int               @id @default(autoincrement())
  products         Product[]
  customerId       Int
  customer         Customer          @relation(fields: [customerId], references: [id])
  payments         CustomerPayment[]
  date             String
  createAt         DateTime          @default(now())
  updateAt         DateTime          @updatedAt
  customerProducts CustomerProduct[]
}

// customer sell product model
model CustomerProduct {
  id               Int               @id @default(autoincrement())
  customer         Customer          @relation(fields: [customerId], references: [id])
  customerId       Int
  product          Product           @relation(fields: [productId], references: [id])
  productId        Int
  chalanId         Int
  chalan           CustomerChalan    @relation(fields: [chalanId], references: [id])
  product_rate     Float
  finishedProducts FinishedProduct[]
  createAt         DateTime          @default(now())
  updateAt         DateTime          @updatedAt
}

// customer payment model 
model CustomerPayment {
  id               Int             @id @default(autoincrement())
  date             String
  amount           Float
  customerId       Int
  customer         Customer        @relation(fields: [customerId], references: [id])
  CustomerChalan   CustomerChalan? @relation(fields: [customerChalanId], references: [id])
  customerChalanId Int?
  createAt         DateTime        @default(now())
  updateAt         DateTime        @updatedAt
}
